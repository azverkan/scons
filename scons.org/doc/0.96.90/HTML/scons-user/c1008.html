<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>Construction Environments</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="SCons User Guide 0.96.90"
HREF="book1.html"><LINK
REL="PREVIOUS"
TITLE="Explicit Dependencies:  the Depends Method"
HREF="x995.html"><LINK
REL="NEXT"
TITLE="Copying Construction Environments"
HREF="x1075.html"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>SCons User Guide 0.96.90</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x995.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1075.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="CHAP-ENVIRONMENTS"
></A
>Construction Environments</H1
><P
>&#13;   It is rare that all of the software in a large,
   complicated system needs to be built the same way.
   For example, different source files may need different options
   enabled on the command line,
   or different executable programs need to be linked
   with different libraries.
   <TT
CLASS="APPLICATION"
>SCons</TT
> accomodates these different build
   requirements by allowing you to create and
   configure multiple <TT
CLASS="LITERAL"
>construction environments</TT
>
   that control how the software is built.
   Technically, a <TT
CLASS="LITERAL"
>construction environment</TT
> is an object
   that has a number of associated
   <TT
CLASS="LITERAL"
>construction variables</TT
>, each with a name and a value.
   (A construction environment also has an attached
   set of <TT
CLASS="CLASSNAME"
>Builder</TT
> methods,
   about which we'll learn more later.)

 </P
><P
>&#13;   A <TT
CLASS="LITERAL"
>construction environment</TT
> is created by the <TT
CLASS="FUNCTION"
>Environment</TT
> method:

 </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    env = Environment()
  </PRE
></TD
></TR
></TABLE
><P
>&#13;   By default, <TT
CLASS="APPLICATION"
>SCons</TT
> intializes every
   new construction environment
   with a set of <TT
CLASS="LITERAL"
>construction variables</TT
>
   based on the tools that it finds on your system,
   plus the default set of builder methods
   necessary for using those tools.
   The construction variables
   are initialized with values describing
   the C compiler,
   the Fortran compiler,
   the linker,
   etc.,
   as well as the command lines to invoke them.

 </P
><P
>&#13;   When you initialize a construction environment
   you can set the values of the
   environment's <TT
CLASS="LITERAL"
>construction variables</TT
>
   to control how a program is built.
   For example:

 </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    env = Environment(CC = 'gcc',
                      CCFLAGS = '-O2')

    env.Program('foo.c')
  </PRE
></TD
></TR
></TABLE
><P
>   
   The construction environment in this example
   is still initialized with the same default
   construction variable values,
   except that the user has explicitly specified use of the
   GNU C compiler <TT
CLASS="APPLICATION"
>gcc</TT
>,
   and further specifies that the <TT
CLASS="LITERAL"
>-O2</TT
>
   (optimization level two)
   flag should be used when compiling the object file.
   In other words, the explicit initializations of
   <A
HREF="a3061.html#CV-CC"
><TT
CLASS="ENVAR"
>$CC</TT
></A
> and <A
HREF="a3061.html#CV-CCFLAGS"
><TT
CLASS="ENVAR"
>$CCFLAGS</TT
></A
>
   override the default values in the newly-created
   construction environment.
   So a run from this example would look like:

 </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    % <TT
CLASS="USERINPUT"
><B
>scons -Q</B
></TT
>
    gcc -O2 -c -o foo.o foo.c
    gcc -o foo foo.o
 </PRE
></TD
></TR
></TABLE
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="AEN1035"
></A
>Multiple <TT
CLASS="LITERAL"
>Construction Environments</TT
></H1
><P
>&#13;   The real advantage of construction environments
   is that you can create as many different construction
   environments as you need,
   each tailored to a different way to build
   some piece of software or other file.
   If, for example, we need to build
   one program with the <TT
CLASS="LITERAL"
>-O2</TT
> flag
   and another with the <TT
CLASS="LITERAL"
>-g</TT
> (debug) flag,
   we would do this like so:

   </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>      opt = Environment(CCFLAGS = '-O2')
      dbg = Environment(CCFLAGS = '-g')

      opt.Program('foo', 'foo.c')

      dbg.Program('bar', 'bar.c')
   </PRE
></TD
></TR
></TABLE
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>      % <TT
CLASS="USERINPUT"
><B
>scons -Q</B
></TT
>
      cc -g -c -o bar.o bar.c
      cc -o bar bar.o
      cc -O2 -c -o foo.o foo.c
      cc -o foo foo.o
   </PRE
></TD
></TR
></TABLE
><P
>&#13;   We can even use multiple construction environments to build
   multiple versions of a single program.
   If you do this by simply trying to use the
   <A
HREF="a5264.html#B-PROGRAM"
><TT
CLASS="FUNCTION"
>Program</TT
></A
> builder with both environments, though,
   like this:

   </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>      opt = Environment(CCFLAGS = '-O2')
      dbg = Environment(CCFLAGS = '-g')

      opt.Program('foo', 'foo.c')

      dbg.Program('foo', 'foo.c')
   </PRE
></TD
></TR
></TABLE
><P
>&#13;   Then <TT
CLASS="APPLICATION"
>SCons</TT
> generates the following error:

   </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>      % <TT
CLASS="USERINPUT"
><B
>scons -Q</B
></TT
>
      
      scons: *** Two environments with different actions were specified for the same target: foo.o
      File "SConstruct", line 6, in ?
   </PRE
></TD
></TR
></TABLE
><P
>&#13;   This is because the two <TT
CLASS="FUNCTION"
>Program</TT
> calls have
   each implicitly told <TT
CLASS="APPLICATION"
>SCons</TT
> to generate an object file named
   <TT
CLASS="FILENAME"
>foo.o</TT
>,
   one with a <A
HREF="a3061.html#CV-CCFLAGS"
><TT
CLASS="ENVAR"
>$CCFLAGS</TT
></A
> value of
   <TT
CLASS="LITERAL"
>-O2</TT
>
   and one with a <A
HREF="a3061.html#CV-CCFLAGS"
><TT
CLASS="ENVAR"
>$CCFLAGS</TT
></A
> value of
   <TT
CLASS="LITERAL"
>-g</TT
>.
   <TT
CLASS="APPLICATION"
>SCons</TT
> can't just decide that one of them
   should take precedence over the other,
   so it generates the error.
   To avoid this problem,
   we must explicitly specify
   that each environment compile
   <TT
CLASS="FILENAME"
>foo.c</TT
>
   to a separately-named object file
   using the <A
HREF="a5264.html#B-OBJECT"
><TT
CLASS="FUNCTION"
>Object</TT
></A
> builder, like so:

   </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>      opt = Environment(CCFLAGS = '-O2')
      dbg = Environment(CCFLAGS = '-g')

      o = opt.Object('foo-opt', 'foo.c')
      opt.Program(o)

      d = dbg.Object('foo-dbg', 'foo.c')
      dbg.Program(d)
   </PRE
></TD
></TR
></TABLE
><P
>&#13;   Notice that each call to the <TT
CLASS="FUNCTION"
>Object</TT
> builder
   returns a value,
   an internal <TT
CLASS="APPLICATION"
>SCons</TT
> object that
   represents the object file that will be built.
   We then use that object
   as input to the <TT
CLASS="FUNCTION"
>Program</TT
> builder.
   This avoids having to specify explicitly
   the object file name in multiple places,
   and makes for a compact, readable
   <TT
CLASS="FILENAME"
>SConstruct</TT
> file.
   Our <TT
CLASS="APPLICATION"
>SCons</TT
> output then looks like:

   </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>      % <TT
CLASS="USERINPUT"
><B
>scons -Q</B
></TT
>
      cc -g -c -o foo-dbg.o foo.c
      cc -o foo-dbg foo-dbg.o
      cc -O2 -c -o foo-opt.o foo.c
      cc -o foo-opt foo-opt.o
   </PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x995.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1075.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Explicit Dependencies:  the <TT
CLASS="FUNCTION"
>Depends</TT
> Method</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Copying <TT
CLASS="LITERAL"
>Construction Environments</TT
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>